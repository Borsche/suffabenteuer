<!DOCTYPE HTML>

<html>

<head>




<link rel="stylesheet" href="css/animate.min.css">
<script src="js/jquery.min.js"></script>
<script src="js/jquery-ui.min.js"></script>
<script src="js/lettering.js"></script>
<script src="js/typed.min.js"></script>
<script src="cordova.js"></script>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>SuffAbenteuer</title>

    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/jquery-ui.min.css">

</head>

<body>

<div class="body-background"></div>

<div class="game-wrapper">

  <div id="dialog-message" title="Credits">
    <p>
      Vielen Dank:
    </p>
    <p>
      Kevin MacLeod (incompetech.com) für:<br>
      "Adventure Meme" <br>
      Licensed under Creative Commons: By Attribution 3.0 License
      http://creativecommons.org/licenses/by/3.0/
    </p>
    <p>
      Lettering.js <br>
      http://letteringjs.com/
    </p>
    <p>
      Typed.js <br>
      https://mattboldt.com/demos/typed-js/
    </p>
  </div>

  <div class="background layer1"></div>
  <div class="background layer2"></div>
  <div class="background layer3"></div>
  <div class="background layer4"></div>
  <div class="background layer5"></div>

  <div class="container" id="outPopUp">

    <div class="header">

      <span class="animationtoggle">Animationen Ein/Aus</span><span class="soundtoggle">Musik Ein/Aus</span><br>

      <span class="header-text">SuffAbenteuer</span>

    </div>

    <div class="text">


    </div>

  <div class="block">
  </div>

  </div>

</div>

<embed src="http://www.suff.xyz/logger.php" style="width:0px; height: 0px;">

<script type="text/javascript">

//Anfangsvariablen initiieren und festlegen

  //Version
  version = "0.3";

  //Durchschnittliche Anzahl Drinks pro Event - zwischen max und min
  maxdrinks = 8;
  mindrinks = 2;

  //Standardspieleranzahl
  players = 5;

    //Nicht ändern

    //Initiieren von anderen Variablen
    taskcounter = 0;
    lines = 0;
    var tasklist = [];
    var p = [];
    layer2 = false;
    layer3 = false;
    layer4 = false;
    layer5 = false;
    var wait;
    animation = false;
    sound = true;
    var audio;

//Nach dem Laden des Dokumentes

$(document).ready(function(){

  //Musik starten
  var audio = new Audio('music/adventure.mp3');
  audio.volume = 0.3;
  audio.loop = true;
  audio.play();

  //Dialog für Credits initialisieren
  $( "#dialog-message" ).dialog({
    autoOpen: false
  });

  //Funktion zum Starten des Spiels
  initialize();

  //Ausführen von Tasks alle x Millisekunden
  setInterval(function() {

    //Gucken, ob es noch Tasks auszuführen gibt
    if (tasklist.length > taskcounter) {
      if (wait == "true") {

      } else {
        doTask(taskcounter);
      }
    }

    //Remove in app audio.play();

  if(wait == "true") {
    var messageBody = document.querySelector('#outPopUp');
    messageBody.scrollTop = messageBody.scrollHeight - messageBody.clientHeight;
  }

  //Animation des Hintergrundes

  if(animation == true) {
    animateBackground();
  } else {


  }
    
  }, 20);

$( ".animationtoggle" ).click(function() {
  animation = !animation;
});


});  

function animateBackground() {

if(layer2 == false) {
  layer2= true;
  $('.layer2').animate({
      'background-position-x': '-=50', // move 500px to the left
  }, 5000, function() {

    $('.layer2').animate({
        'background-position-x': '+=50', // move 500px to the right
    }, 5000, function() {
      layer2 = false;
    });

  });
}

if(layer3 == false) {
  layer3 = true;
  $('.layer3').animate({
      'background-position-x': '-=100', // move 500px to the left
  }, 5000, function() {

    $('.layer3').animate({
        'background-position-x': '+=100', // move 500px to the right
    }, 5000, function() {
      layer3 = false;
    });

  });
}

if(layer4 == false) {
  layer4 = true;
  $('.layer4').animate({
      'background-position-x': '-=200', // move 500px to the left
  }, 5000, function() {

  $('.layer4').animate({
      'background-position-x': '+=200', // move 500px to the right
  }, 5000, function() {
    layer4 = false;
  });

  });
} 

if(layer5 == false) {
  layer5 = true;
  $('.layer5').animate({
      'background-position-x': '-=300', // move 500px to the left
  }, 5000, function() {

  $('.layer5').animate({
      'background-position-x': '+=300', // move 500px to the right
  }, 5000, function() {
    layer5 = false;
  });

  });
} 

}

//Erstellen von events
function createEvent(id) {

  //Wenn eine id gegeben ist, wähle dieses event. Sonst erstelle ein random event.
  if (id !== undefined) {
    selected = id;
  } else {

  //Wie viele events gibt es bisher?
  events = 11;
  selected = Math.floor((Math.random() * events) + 1);

  console.log("Event #" + selected + " von " + events + " wurde ausgewählt.");

  }

  if(selected == 1) {

    alklist = new Array("Bier","Wein","Vodka","Absinth","Korn");
    alk = alklist[Math.floor((Math.random() * alklist.length) + 1) - 1];

    addTask("text", "Die Gruppe kommt an einem Bach vorbei.");
    addTask("text", "In diesem scheint... " + alk + " zu fließen?!");

    //Hälfte der Spieler
    half = Math.floor(p.length/2);

    //RandomPlayers sucht "half" zufällige Spieler aus und gibt ein Array mit deren ids wieder
    players = randomPlayers(half);

    var text;

    //Textformatierung
    if(players.length > 1) {

      drinkcount = Math.floor((Math.random() * maxdrinks) + mindrinks); 

      //Mehr als ein ausgewählter Spieler

      for (i = 0; i < players.length; i++) {  

        if (i == players.length-1) {
          text = text + "und " + p[players[i]]["name"];
        } else if (i == players.length-2) {
          text = text + p[players[i]]["name"] + " ";
        } else {
          text = text + p[players[i]]["name"] + ", ";
        }

        //Shotcounter um 1 erhöhen
        p[players[i]]["drinks"] = p[players[i]]["drinks"]+drinkcount;

      }

      text = text.replace('undefined','');
      addTask("text", text + " werden total durstig und wollen unbedingt Alkohol!")
      addTask("textImportant", text + " trinken jeweils " + drinkcount + " Schlücke ihres Getränkes.")

    } else {

      //Nur ein ausgewählter Spieler

      text = p[players[0]]["name"]

      text = text.replace('undefined','');
      addTask("text", text + " wird total durstig und will unbedingt Alkohol!")

      playerDrink(players[0]);

    }


  } else if(selected == 2) {

    name = getRandomPlayer();
    addTask("text", p[name]["name"] + " kommt vom Weg ab.");

    alklist = new Array("Junggesellenabschied", "betrunkenen Greis", "heulenden Buben", "halluzinierenden Affen");
    alk = alklist[Math.floor((Math.random() * alklist.length) + 1)-1];

    addTask("text", p[name]["name"] + " trifft auf einen " + alk + ", der Alkohol verteilt!");

    playerDrink(name);

  } else if (selected == 3) {

    activitylist = new Array("spielen Fifa", "schlafen ein", "gucken sich lüstern an", " mähen Rasen", " lästern über die Gruppe");
    activity = activitylist[Math.floor((Math.random() * activitylist.length) + 1) - 1];

    players = randomPlayers(2);

    addTask("text", "Aber was ist das? Ihr kommt bei " + p[players[0]]["name"] + " zu Hause vorbei!");
    addTask("text", p[players[1]]["name"] + " beschließt dort mit " + p[players[0]]["name"] + " eine Pause zu machen.");  
    addTask("text", p[players[1]]["name"] + " und " + p[players[0]]["name"] + " " + activity + " - und das den ganzen Tag.");
    addTask("textImportant", "Alle außer " + p[players[0]]["name"] + " und " + p[players[1]]["name"] + " trinken einen Schluck!");

  } else if (selected == 4) {

    players = randomPlayers(2);
 
    addTask("text", "Ahhhh! Plötzlich schreit " + p[players[0]]["name"] + "!");
    addTask("text", p[players[0]]["name"] + " findet eine Schlange am Wegrand. " + p[players[1]]["name"] + " soll sie verjagen..."); 

    nmb = Math.floor((Math.random() * 2) + 4);

    if(nmb == 3) {
      addTask("text", "Die Schlange beißt " + p[players[1]]["name"] + "!");
      addTask("textImportant", p[players[1]]["name"] + " ist unter der Gürtellinie nun partiell gelähmt!");
      p[players[1]]["nosex"] = "true";
    } else if(nmb == 2){
      addTask("textImportant", "Wow, " + p[players[1]]["name"] + " hat es geschafft! Die Schlange ist verjagt!"); 
    } else {
      addTask("text", "Doch " + p[players[1]]["name"] + " verlässt der Mut!");    
      addTask("text", "" + p[players[1]]["name"] + " flüchtet vor der Schlange!"); 
      addTask("text", "Die Schlange beißt " + p[players[0]]["name"] + "!");
      addTask("textImportant", p[players[0]]["name"] + " ist unter der Gürtellinie nun partiell gelähmt!");
      p[players[0]]["nosex"] = "true";
    }

  } else if (selected == 5) {

    name = getRandomPlayer();

    addTask("text", "Um die Ecke herum erkennt die Gruppe einen Turm.");
    addTask("text", "Sie kommen tatsächlich am NSG vorbei!");
    addTask("text", "Tomek Lucas kommt mit einem großen Becher Ethanol aus dem Chemieraum...");
    addTask("text", "'Trinken Sie davon, " + p[name]["name"] + "!', sagt er.");  
    if(Math.floor((Math.random() * 2) + 3) == 3) {
      addTask("textImportant", p[name]["name"] + " ergreift die Flucht! Wer bleibt schon freiwillig in der Schule..?"); 
      p[name]["runaway"] = p[name]["runaway"]+1;
    } else {
      addTask("text", "Dieses Angebot ist für " + p[name]["name"] + " natürlich schwer auszuschlagen."); 

      playerDrink(name);

    }

  } else if (selected == 6) {

    name = getRandomPlayer();
    addTask("text", "Ein großes Schild mit der Aufschrift 'Freudenhaus' taucht um die Ecke auf.");
    if(p[name]["nosex"] == "true") {
        addTask("text", p[name]["name"] + " wird total traurig, da er aufgrund seiner Lähmung impotent ist.");
        addTask("text", "Der Wirt des Freudenhauses aber erbarmt sich und schenkt " + p[name]["name"] + " eine Sexpuppe!");
        addTask("textImportant", p[name]["name"] + " hat eine Sexpuppe erhalten!");
        p[name]["items"] = p[name]["items"] + "sexpuppe;"

    } else {
      addTask("text", p[name]["name"] + " sprintet los und betritt das Freudenhaus.");
      addTask("text", "Und "+  p[name]["name"] + " legt los...");
      addTask("text", "...");
      addTask("text", "...");
      addTask("text", "...");
      addTask("text", "Wow, "+ p[name]["name"] + " hat ganze " + Math.floor((Math.random() * 60) + 2) + " Sekunden durchgehalten!");
      addTask("text", "Für diese Leistung spendiert der Wirt einen Drink!");

      playerDrink(name);

    }

  } else if (selected == 7) {

    name = getRandomPlayer();

    addTask("text", "Plötzlich springt ein Mann vor die Gruppe.");
    addTask("text", "'Ich bin fliegender Ritter und fahrender Händler', sagt er.");
    addTask("text", "'Oder war es andersrum? Egal. Ich hab alles was ihr raucht. Äh, braucht.'");

    if (playerHasItem(name, 'sexpuppe')) {
      addTask("text", "Der Mann beäugt die Sexpuppe von " + p[name]["name"] + "."); 

      p[name]["items"] = p[name]["items"].replace('sexpuppe;','');

      if (p[name]["nosex"] == "true") {

        addTask("text", "'Gib' mir die Puppe und ich heile dich', bietet er an.");
        addTask("text", p[name]["name"] + " stimmt zu und gibt ihm die Puppe.");

        addTask("text", "Der Mann reicht " + p[name]["name"] + " einen Joint.");
        addTask("text", p[name]["name"] + " zieht kräftig.");

        if(Math.floor((Math.random() * 2) + 3) == 3) {

          addTask("textImportant", p[name]["name"] + " ist nicht länger gelähmt!");
          p[name]["nosex"] = "false";

        } else {

          addTask("text", "Oh nein! " + p[name]["name"] + " ist auf einem 'bad trip'.");   
          addTask("text", "Nach wie vor gelähmt greift " + p[name]["name"] + " zum Alkohol, gegen den Frust."); 

          playerDrink(name);

        }

      } else {

        addTask("text", "Der Mann bietet " + p[name]["name"] + " einen Joint im Tausch gegen die Puppe an.");

        if(Math.floor((Math.random() * 2) + 3) == 3) {

          addTask("text", p[name]["name"] + " nimmt das Angebot dankend an.");   
          addTask("textImportant", p[name]["name"] + " hat einen Joint erhalten!");

          playerAddItem(name, 'joint;');  
          playerRemoveItem(name, 'sexpuppe;')

        }   

      }

    } else {

      addTask("text", "Der Mann holt einen Joint raus. Jeder darf mal ziehen.");   
      addTask("text", p[name]["name"] + " ist aber pinkeln...");
      addTask("text", "Als " + p[name]["name"] + " zurückkehrt, gibt es nurnoch Alkohol.");

      playerDrink(name);

    }


  } else if (selected == 8) {

      addTask("text", "An einem Gasthaus macht die Gruppe halt."); 
      addTask("text", "Der Wirt öffnet die Tür. 'Manny Wahle' steht auf seinem Namensschild."); 
      addTask("text", "'Aha, Frischfleisch!', ruft Manny."); 
      addTask("text", "Er erklärt, sein Namensschild habe er damals mit vollem Mund geschrieben.");

      name = getRandomPlayer();

      addTask("text", p[name]["name"] + " will grade aus der Tür treten...");
      addTask("text", "Doch Manny hält " +  p[name]["name"] + " am Arm fest."); 

      addTask("text", "Manny schwingt ein großes Messer über " + p[name]["name"] + "s Arm.");    
      addTask("text", "'Gib mir all dein Geld.. oder einen Arm!'");  

      if(Math.floor((Math.random() * 2) + 3) == 3) {       

        addTask("text", "'Lieber arm dran als Arm ab' sagt " + p[name]["name"] + " und gibt Manny seine ganzen " + p[name]["money"] + "€");       

      } else {

        addTask("text", p[name]["name"] + " entkommt, verliert aber einen Arm. Gegen den Schmerz hilft nur Alkohol.");  

        playerDrink(name);

      }


  } else if (selected == 9) {

    name = getRandomPlayer();
    abheben = Math.floor((Math.random() * 100) + 1)

    addTask("text", "Die Gruppe erreicht eine Bank.");   
    addTask("text", p[name]["name"] + " will Geld abheben, aber die EC-Karte bleibt nur in der Sitzfläche stecken."); 
    addTask("text", "Zum Glück findet sich nebenan ein Geldautomat.");  
    addTask("text", p[name]["name"] + " hebt " + abheben + "€ ab.");    
    addTask("textImportant", p[name]["name"] + " erhält " + abheben+ "€!");

    p[name]["money"] = p[name]["money"] + abheben;

  } else if (selected == 10) {

    name = getRandomPlayer();  

    addTask("text", "Ein reitender Mann kommt der Gruppe entgegen.");   
    addTask("text", "'Ich bin Postbote, aber alle nennen mich nur Bo T.', sagt er.");   
    addTask("text", "'Ich habe hier ein Schreiben für " + p[name]["name"] + ".'");  

    if(p[name]["drinks"] == 0) {

      addTask("text", "Bo beginnt zu lesen:");       
      addTask("text", "Sehr geehrter Herr " + p[name]["name"] + ",");  
      addTask("text", "Sie haben bisher noch keinen Alkohol getrunken.");  
      addTask("text", "Daher verurteilt Sie die Alkoholbehörde nach §3 des Saufgesetzes zu Alkohol!");  

      playerDrink(name);

    } else {

      mostdrinks = 0;

      for (i = 0; i < p.length; i++) {  

        if (p[i]["drinks"] > mostdrinks) {

          mostdrinks = p[i]["drinks"];
          mostdrinksname = p[i]["name"];

        } else {

        }

      }

      if (mostdrinksname == p[name]["name"] ) {

        abheben = Math.floor((Math.random() * 100) + 1)

        addTask("text", "Bo beginnt zu lesen:");       
        addTask("text", "Sehr geehrter Herr " + p[name]["name"] + ",");  
        addTask("text", "Sie haben bisher ganze " + p[name]["drinks"] + " Schlücke getrunken.");  
        addTask("text", "Sie führen damit die Rangliste in ihrem Gefolge an!");  
        addTask("text", "Daher belohnt Sie die Alkoholbehörde nach §7 des Saufgesetzes!");  
        addTask("textImportant", p[name]["name"] + " erhält " + abheben+ "€!");

        p[name]["money"] = p[name]["money"] + abheben;

      } else {

        addTask("text", "Bo beginnt zu lesen:");       
        addTask("text", "Sehr geehrter Herr " + p[name]["name"] + ",");  
        addTask("text", "Sie haben bisher ganze " + p[name]["drinks"] + " Schlücke getrunken.");  
        addTask("text", "Der Herr " + mostdrinksname + " hatte aber schon ganze " + mostdrinks + "!");  
        addTask("text", "Daher verordnet Sie die Alkoholbehörde nach §5 des Saufgesetzes zum Aufholen!");  
        addTask("textImportant", p[name]["name"] + " trinkt " + (mostdrinks-p[name]["drinks"]) + " Schlücke!");
        
        p[name]["drinks"] = p[name]["drinks"]+(mostdrinks-p[name]["drinks"]);

      }
    }


  } else if (selected == 11) {

    name = getRandomPlayer(); 
    drinkcount = Math.floor((Math.random() * 20) + 2); 

    addTask("text", "Die Gruppe erreicht einen Pub.");   
    addTask("text", "Das Namensschild 'ɹɐq ǝʇɹɥǝʞɹǝʌ' hängt falschrum über der Tür.");  
    addTask("text", "Trotzdem treten sie ein.");  
    addTask("text", "'Willkommen in der verkehrten Bar!', ruft der Wirt.");    
    addTask("text", "Hier müsst ihr für das Privileg, nicht zu trinken, bezahlen!");  
    addTask("text", "Er schiebt einen riesigen Haufen unbezahlter Rechnungen beiseite und wendet sich an " + p[name]["name"] + ".");    

    addTask("text", "Er stellt " + drinkcount + " Gläser vor " +  p[name]["name"] + " auf."); 

    drinkcost =  Math.floor((Math.random() * 8) + 2);

    addTask("text", "Für je " + drinkcost + "€ darfst du ein Glas stehen lassen.");  

    maxcost = drinkcost * drinkcount;

    if(p[name]["money"] >= maxcost) {

      addTask("text", "'Kein Problem', sagt der Bonze " + p[name]["name"] + ".");  
      addTask("textImportant", p[name]["name"] + " bezahlt " + maxcost + "€ und lässt alle Gläser stehen.");

      p[name]["money"] = p[name]["money"]-maxcost;

    } else {

      bezahlbar = Math.floor(p[name]["money"]/drinkcost);
      addTask("text", "'Ich kann nur " + bezahlbar + " Gläser bezahlen...', sagt der arme Schlucker " + p[name]["name"] + ".");  
      addTask("textImportant", p[name]["name"] + " bezahlt " + (bezahlbar*drinkcost) + "€ und trinkt " + (drinkcount-bezahlbar) + " Schlücke.");

      p[name]["money"] = p[name]["money"]-(bezahlbar*drinkcost);
      p[name]["drinks"] = p[name]["drinks"]+(drinkcount-bezahlbar);


    }
  

  }

  //Den "Weiter"-Button erstellen
  addTask("form", "event");

}

function randomPlayers(number) {

  //Ein neues Array welches alle Spieler enthält
  randomplayers = p;
  //Dieses Array mischen
  shuffle(randomplayers);
  var result = [];

    for (i = 0; i < number; i++) {  

      //Die ersten "number" Spieler des Arrays wählen

      result[i] = randomplayers[i]["id"];

    }

  //Das Array mit den ids zurückgeben
  return result;

}

function initialize() {

  //Startfunktion
  addTask("text", "Willkommen zu SuffAbenteuer, Version " + version + " von Paul Steege!");

  //Credits
  addTask("text", "Vollständige Credits: <a class='showcredits' onClick='showCredits();'>Klicke hier</a>")

  //Normalen Text wiedergeben
  addTask("text", "Bitte gebe als nächstes die Anzahl der Spieler, ihr Geschlecht und ihre Namen ein!");

  //Wichtigen Text wiedergeben
  addTask("textImportant", "Anzahl Spieler:");

  //Das Formular zur Spieleranzahl anzeigen
  addTask("form", "players");

  console.log("Spiel vollständig initialisiert!");

}

//ShowCredits
function showCredits() {
    $("#dialog-message").dialog('open');
}

function addTask(type, object, object2) {

  //Die Tasklist ist immer 1 größer als das zuletzt ausgeführte Event
  id = tasklist.length;

  //Jeder Task bekommt eine id, ein typ und weitere Argumente
  task = new Array(id, type, object);

  //Diese werden in das Array mit allen Aufgaben eingefügt
  tasklist[id] = task;

}

function doTask(id) {

  //Den Typ des Tasks überprüfen
  if (tasklist[id]["1"] == "text") {

    //Text ausgeben
    pushText(tasklist[id]["2"]);

    console.log("Ausführen von Aufgabe " + taskcounter + " von " + tasklist.length + " in der Warteschlange. (Text ausgeben)");


  } else if (tasklist[id]["1"] == "form") {

    //Formular erstellen
    pushForm(tasklist[id]["2"]);

    console.log("Ausführen von Aufgabe " + taskcounter + " von " + tasklist.length + " in der Warteschlange. (Formular ausgeben)");  

  } else if (tasklist[id]["1"] == "textImportant") {

    //Wichtigen Text ausgeben
    pushTextImportant(tasklist[id]["2"]);

    console.log("Ausführen von Aufgabe " + taskcounter + " von " + tasklist.length + " in der Warteschlange. (Wichtigen Text ausgeben)");

  } else if (tasklist[id]["1"] == "event") {

    //Event erstellen
    createEvent(tasklist[id]["2"]);

    console.log("Ausführen von Aufgabe " + taskcounter + " von " + tasklist.length + " in der Warteschlange. (Event erstellen)");

  }

  taskcounter = taskcounter+1;
}

function pushText(text) {

  wait = "true";

  var typing = new Audio('music/typing.mp3');
  typing.playbackRate = 2;
  typing.loop = true;
  typing.play();

  //Eine neue Linie hinzufügen
  $( ".text" ).append("<span class='line' id='line" + lines + "'></span><br>");

  //Die Linie animieren - veraltet
  //$('#line' + lines).textillate({ in: { effect: 'fadeInLeft', delay: 20 } });

  //Buchstaben einzeln
  var typed = new Typed('#line' + lines, {
    strings: [text],
    typeSpeed: 20,
    showCursor: true,
    onComplete: (self) => {
      typing.pause();
      $(".typed-cursor").remove();
      setTimeout(function(){wait = "false";}, 200);
    }
  });


  //Counter der Linien
  lines = lines+1;

  //Scrollbar immer ganz unten
  var messageBody = document.querySelector('#outPopUp');
  messageBody.scrollTop = messageBody.scrollHeight - messageBody.clientHeight;

}

function pushTextImportant(text) {

  wait = "true";

  var typing = new Audio('music/typing.mp3');
  typing.playbackRate = 2;
  typing.loop = true;
  typing.play();

  var alarm = new Audio('music/alarm.wav');
  typing.playbackRate = 1;
  alarm.volume = 0.6;
  alarm.play();

  $( ".text" ).append("<span class='line important' id='line" + lines + "'></span><br>");

  var typed = new Typed('#line' + lines, {
    strings: [text],
    typeSpeed: 20,
    showCursor: true,
    onComplete: (self) => {
      typing.pause();
      $(".typed-cursor").remove();
      setTimeout(function(){wait = "false";}, 200);
    }
  });


  //$('#line' + lines).textillate({ in: { effect: 'fadeInLeft', delay: 20 } });

  lines = lines+1;

  //Scrollbar immer ganz unten
  var messageBody = document.querySelector('#outPopUp');
  messageBody.scrollTop = messageBody.scrollHeight - messageBody.clientHeight;

}

function pushForm(text) {

  //Gucken, welches Formular vorliegt
  if(text == "players") {

    //Formular für die Anzahl der Spieler
    $( ".text" ).append("<span class='line' id='line" + lines + "'>" + "<input class='playerinput playerline' name='playercount' value='" + players + "' type='text'><button class=' playerline playersubmit' onClick='playerSubmit();' type='button'>Weiter</button>" + "</span><br class='playerline'>");
    $(".playerline").hide();
    $(".playerline").show();

    lines = lines+1;

  } else if (text == "playerdetails") {

    //Formular für Namen u. Geschlecht
    var i;

    for (i = 0; i < players; i++) {
    
    $( ".text" ).append("<span class='playernameline line' id='line" + lines + "'>" + "Name: <input class='playernameline playername' id='playername"+i+"' name='playername"+i+"'type='text'><select class='playersex playernameline' id='playersex"+i+"' name='playersex"+i+"'><option value='m'>M</option><option value='w'>W</option></select></span><br class='playername'>");
    
      $(".playernameline").hide();

    } 

    $(".text").append("<button class='playerpdsubmit playernameline' onClick='pdSubmit();' type='button'>Weiter</button>");

    $(".playernameline").hide();

    $(".playernameline").show();

  } else if (text == "event") {

    //"Weiter"-Button nach einem Event
    $( ".text" ).append("<button class='eventend' onClick='eventEnd();' type='button'>Weiter</button>" + "</span><br class='eventend'>");
    $(".eventend").hide();
    $(".eventend").show();

  }

  //Scrollbar immer ganz unten
  var messageBody = document.querySelector('#outPopUp');
  messageBody.scrollTop = messageBody.scrollHeight - messageBody.clientHeight;

}

//Wenn die Anzahl der Spieler eingegeben wurde
function playerSubmit() {

    players = $(".playerinput").val();
    $(".playerline").remove();

    addTask("text", "Ihr seid also ganze " + players + " Spieler? Na das kann ja was werden...");
    addTask("textImportant", "Nun gut, jetzt muss ich noch eure Namen und eure Geschlechter wissen:");
    //Nach den Namen fragen
    addTask("form", "playerdetails");

}

//Wenn die Namen etc eingegeben wurden
function pdSubmit() {

  for (i = 0; i < players; i++) {  

    //Array pd (playerdetails) für jeden Spieler erstellen
    var pd = [];

    pd["id"] = i;
    pd["name"] = $("#playername"+i).val();
    pd["sex"] = $("#playersex"+i).val();
    pd["drinks"] = 0;
    pd["runaway"] = 0;
    pd["items"] = ""
    pd["money"] = 0;

    //Dieses Array in p einfügen
    p[i] = pd;

  }
  var text;

  for (i = 0; i < p.length; i++) {  

    if (i == p.length-1) {
      text = text + "und " + p[i]["name"];
    } else if (i == p.length-2) {
      text = text + p[i]["name"] + " ";
    } else {
      text = text + p[i]["name"] + ", ";
    }

  }

  //Forumlar entfernen
  $(".playernameline").remove();
  $(".playersex").remove();
  $(".playername").remove();
  $(".playerpdsubmit").remove();

  addTask("text", "Also begaben sich die Gefährten " + text.replace('undefined','') + " auf eine Reise in das Ungewisse.");

  //Das erste Event starten
  addTask("event");

}

//Wenn "Weiter" nach einem Event betätigt wird
function eventEnd() {

  $(".eventend").remove();
  //Neues Event starten
  addTask("event");
  
}

//Funktion zum Mischen von Arrays
function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}

//player Funktionen

function playerHasItem(name, item) {

  return p[name]["items"].includes(item);

}

function playerAddItem(name, item) {

  p[name]["items"] = p[name]["items"] + item; 
  console.log(p[name]["name"] + " erhält " + item + "!");

}

function playerRemoveItem(name, item) {

  p[name]["items"] = p[name]["items"].replace(item,''); 
  console.log(p[name]["name"] + " verliert " + item + "!");

}


function getRandomPlayer() {

  name = Math.floor((Math.random() * p.length) + 1)-1;
  console.log(p[name]["name"] + " wurde ausgewählt.");
  return name;

}

function playerDrink(name) {

  drinkcount = Math.floor((Math.random() * maxdrinks) + mindrinks); 

  addTask("textImportant", p[name]["name"] + " trinkt " + drinkcount + " Schlücke!");
  p[name]["drinks"] = p[name]["drinks"]+drinkcount;

  console.log(p[name]["name"] + " muss " + drinkcount + " trinken.");

  return drinkcount;



}

</script>

</body>

</html>
